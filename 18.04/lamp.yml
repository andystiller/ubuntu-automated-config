---
- hosts: me
  vars_files:
  - vars/main.yml
  - vars/personal.yml
  vars:
  - ansible_become_pass: "{{ sudopassword }}"
  become: true
  become_method: sudo

  tasks:
  - name: Update apt cache.
    apt: update_cache=yes cache_valid_time=86400

  roles:
  # Essential roles.
  - { role: geerlingguy.firewall }
  - { role: geerlingguy.git }
  #- { role: geerlingguy.postfix }
  - { role: geerlingguy.apache, tags: ['webserver']}
  - { role: geerlingguy.apache-php-fpm, tags: ['webserver'] }
  - { role: geerlingguy.php, tags: ['php'] }
  - { role: geerlingguy.php-pecl, tags: ['php'] }
  - { role: geerlingguy.composer, tags: ['php'] }
  - { role: geerlingguy.mysql, tags: ['database'] }
  - { role: geerlingguy.php-mysql, tags: ['php', 'database'] }


  # Conditionally-installed roles.
  - { role: geerlingguy.drupal-console, tags: ['drupal']}
  #- { role: geerlingguy.drush, tags: ['drupal'] }
  #- { role: geerlingguy.memcached }
  #- { role: geerlingguy.php-memcached, tags: ['php'] }

  #- role: geerlingguy.php-tideways
  
  #  tags: ['php']

  - role: geerlingguy.php-xdebug
    tags: ['php', 'xdebug']

  - role: geerlingguy.php-xhprof
    tags: ['php']

  - role: thom8.php-upload-progress
    tags: ['php']

  #- { role: geerlingguy.blackfire }
  - { role: geerlingguy.adminer, tags: ['database'] }
  - { role: geerlingguy.pimpmylog }
  #- { role: geerlingguy.mailhog }
  - { role: geerlingguy.nodejs }
  - { role: geerlingguy.ruby }
  #- { role: geerlingguy.redis }
  #- { role: geerlingguy.php-redis, tags: ['php'] }
  #- { role: geerlingguy.elasticsearch }
  #- { role: geerlingguy.varnish }

  # Roles for security and stability on production.
  #- { role: geerlingguy.security }